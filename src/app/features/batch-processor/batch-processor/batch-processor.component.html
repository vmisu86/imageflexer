<div class="batch-processor-container">
    <div class="section-header">
        <h2>Batch Studio</h2>
        <p>Handle many images at once: add files, choose conversion and/or resizing, then process.</p>
    </div>

    <nz-card>
        <div class="panel-header">
            <div class="steps">
                <div class="step-title">Quick steps</div>
                <div class="step-list">1) Add images  2) Choose convert and/or resize  3) Process & download</div>
            </div>
            <div class="status">
                <nz-tag [nzColor]="isProcessing ? 'processing' : 'success'">
                    {{ isProcessing ? 'Processingâ€¦' : 'Ready' }}
                </nz-tag>
                <span class="status-hint" *ngIf="isProcessing && progress.total > 0">
                    Processing {{ progress.current }} / {{ progress.total }}
                </span>
                <span class="status-hint" *ngIf="isProcessing && progress.total === 0">Working on your files</span>
                <span class="status-hint" *ngIf="!isProcessing">Drop files or click select</span>
            </div>
        </div>

        <div class="config-grid">
            <nz-card class="config-card" [nzTitle]="convertEnabled ? 'Convert' : 'Convert (off)'" nzSize="small">
                <div class="card-header">
                    <label nz-switch [(ngModel)]="convertEnabled" [ngModelOptions]="{standalone: true}">
                    </label>
                    <span class="card-hint">Turn on to change format/quality</span>
                </div>
                <div class="control">
                    <label>Format</label>
                    <nz-select name="batch-format" [(ngModel)]="config.format" [ngModelOptions]="{standalone: true}"
                        [nzDisabled]="!convertEnabled">
                        <nz-option *ngFor="let option of formatOptions" [nzValue]="option.value"
                            [nzLabel]="option.label">
                        </nz-option>
                    </nz-select>
                </div>
                <div class="control slider-control">
                    <label>Quality</label>
                    <nz-slider name="batch-quality" [(ngModel)]="config.quality" [nzMin]="1" [nzMax]="100"
                        [ngModelOptions]="{standalone: true}"
                        [nzDisabled]="!convertEnabled || config.format === 'image/png'">
                    </nz-slider>
                    <div *ngIf="config.format === 'image/png'" class="hint-text">
                        PNG ignores quality (lossless)
                    </div>
                </div>
            </nz-card>

            <nz-card class="config-card" [nzTitle]="resizeEnabled ? 'Resize' : 'Resize (off)'" nzSize="small">
                <div class="card-header">
                    <label nz-switch [(ngModel)]="resizeEnabled" [ngModelOptions]="{standalone: true}">
                    </label>
                    <span class="card-hint">Turn on to set target dimensions</span>
                </div>
                <div class="control numeric">
                    <label>Max width (px)</label>
                    <nz-input-number name="batch-maxWidth" [(ngModel)]="config.maxWidth" [nzMin]="1" [nzMax]="10000"
                        [ngModelOptions]="{standalone: true}" [nzStep]="10" [nzDisabled]="!resizeEnabled">
                    </nz-input-number>
                </div>
                <div class="control numeric">
                    <label>Max height (px)</label>
                    <nz-input-number name="batch-maxHeight" [(ngModel)]="config.maxHeight" [nzMin]="1" [nzMax]="10000"
                        [ngModelOptions]="{standalone: true}" [nzStep]="10" [nzDisabled]="!resizeEnabled">
                    </nz-input-number>
                </div>
                <div class="control checkbox-control">
                    <label nz-checkbox name="batch-aspect" [(ngModel)]="config.preserveAspectRatio" [ngModelOptions]="{standalone: true}"
                        [nzDisabled]="!resizeEnabled">
                        Preserve aspect ratio
                    </label>
                </div>
            </nz-card>
        </div>

        <app-file-dropzone [isProcessing]="isProcessing" (process)="processImages($event)">
        </app-file-dropzone>
    </nz-card>

    <app-image-preview [images]="imageService.getProcessedImages()" [showComparison]="true" [summary]="summary"
        (download)="downloadImage($event)" (downloadAll)="downloadAll()" (clear)="clearResults()">
    </app-image-preview>
</div>
